<ui:composition template="../layouts/layoutInterior.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
	<ui:define name="content">
		<p:importConstants type="es.mira.insht.constantes.Constantes"
			var="Constantes" />
			<h:form id="form" enctype="multipart/form-data">
				<div class="bloqueFormulario">
					<p:panel header="Link" styleClass="panelModCard">
						<p:panelGrid>
							<p:row>
								<p:column>
									<h:outputLabel for="nombre" value="*Nombre:" />
								</p:column>
								<p:column>
									<p:inputText id="nombre" value="#{linksBean.link.nombre}"
										required="true"
										requiredMessage="Introduzca un nombre para el link" />
									<p:message for="nombre" />
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputLabel for="url" value="Url:" />
								</p:column>
								<p:column>
									<p:inputText id="url" value="#{linksBean.link.url}" required="true"
										requiredMessage="Introduzca una url para el link" />
									<p:message for="nombre" />
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputLabel for="validado" value="Validado:" />
								</p:column>
								<p:column>
									<p:selectOneMenu id="validado" value="#{linksBean.link.validado}">
										<f:selectItem itemLabel="SI" itemValue="1" />
										<f:selectItem itemLabel="NO" itemValue="0" />
									</p:selectOneMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputLabel for="validado" value="Tipo de link:" />
								</p:column>
								<p:column>
									<p:selectOneMenu id="tipo" value="#{linksBean.link.seccion}">
										<f:selectItem itemLabel="MUTUA"
											itemValue="#{Constantes.MUTUAS}" />
										<f:selectItem itemLabel="COMUNIDAD"
											itemValue="#{Constantes.COMUNIDADES}" />
									</p:selectOneMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<p:commandButton value="Seleccionar imágen"
										update="formDocumento:panelDocumento" immediate="true"
										action="#{linksBean.mostrarDialogoNuevaImagen()}" />
								</p:column>
								<p:column>
									<p:graphicImage id="imagen" height="250" width="auto"
										value="#{linksBean.link.imagen.imagenMuestra}" stream="false" />
								</p:column>
							</p:row>
						</p:panelGrid>
						<p:confirmDialog global="true">
							<div class="centrarBotonesDialog">
								<p:button value="Aceptar" styleClass="ui-confirmdialog-yes"
									icon="fa fa-check" />
								<p:button value="Cancelar" styleClass="ui-confirmdialog-no"
									icon="fa fa-remove" />
							</div>
						</p:confirmDialog>

						<p:dialog id="dialog" widgetVar="dialogMessage" header="INFO"
							closable="false">
							<p:messages for="dialogMessage" autoUpdate="true"
								showDetail="true" showSummary="true" />
							<div class="centrarBotonesDialog">
								<p:button value="Cerrar" outcome="/gestorLinks/links" />
							</div>
						</p:dialog>
					</p:panel>
					<div class="botonesFormulario">
						<p:commandButton value="Volver" icon="fa fa-fw fa-undo"
							action="/gestorLinks/links?faces-redirect=true" immediate="true">
						</p:commandButton>
						<p:commandButton actionListener="#{linksBean.guardarLink}"
							value="Aceptar" icon="fa fa-fw fa-check" ajax="false" />
					</div>
				</div>
				
				<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
					closable="false" resizable="false" showHeader="false">
					<p:graphicImage value="/images/loading.gif" />
				</p:dialog>
			</h:form>
			
			
			<p:dialog header="Buscar documentos" widgetVar="dlg" dynamic="true"
					width="700" height="600">
					<h:form id="formDocumento">
					<p:panelGrid columns="1" id="panelDocumento">
						<p:panelGrid columns="2">
							<h:outputLabel for="tituloDocumento" styleClass="dialogLabel"
								value="Título:" />
							<p:inputText id="tituloDocumento"
								value="#{linksBean.documentoBusqueda.titulo}" />

							<h:outputLabel for="nombreFichero" styleClass="dialogLabel"
								value="Nombre de fichero:" />
							<p:inputText id="nombreFichero"
								value="#{linksBean.documentoBusqueda.nombreArchivo}" />

							<h:outputLabel for="descripcionDocumento"
								styleClass="dialogLabel" value="Descripción:" />
							<p:inputText id="descripcionDocumento"
								value="#{linksBean.documentoBusqueda.descripcion}" />

							<h:outputLabel for="listaEtiquetas" styleClass="dialogLabel"
								value="Etiquetas:" />
							<p:selectCheckboxMenu id="listaEtiquetas"
								panelStyleClass="hideDisabled"
								value="#{linksBean.documentoBusqueda.etiquetasSeleccionadas}"
								multiple="true" filter="true" filterMatchMode="startsWith"
								label="Etiquetas" class="selectFiltro" converter="#{etiquetaConverter}">
								
								<f:attribute name="collectionType" value="java.util.ArrayList" />
								
								<f:selectItems value="#{linksBean.listaEtiquetas}"
									var="etiqueta" itemLabel="#{etiqueta.nombre}"
									itemValue="#{etiqueta}" />
							</p:selectCheckboxMenu>
							<p:commandButton actionListener="#{linksBean.buscarDocumento}"
								value="Buscar" icon="fa fa-search" 
								class="botonExpedienteTab left" update="formDocumento:tablaDocumentos"
								oncomplete="$('.mensajeSinResultados').css('opacity', 1)"
								onstart="PF('statusDialog').show()"
								onsuccess="PF('statusDialog').hide()" />
						</p:panelGrid>
						<p:dataTable class="tabActividad" id="tablaDocumentos"
							var="documento" rowIndexVar="rowIndex"
							value="#{linksBean.modelDocumento}" editable="true"
							rows="#{Constantes.TAMPAGINA}" rowsPerPageTemplate="5,10,15,20"
							paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							paginator="true" rowKey="#{documento.id}" lazy="true"
							onkeypress="if (event.keyCode == 13) {return false; }"
							emptyMessage="No existe ningún resultado que cumpla los parámetros de su búsqueda.">

							<p:column headerText="Título" width="80">
								<h:outputText id="titulo_index" value="#{documento.titulo}" />
								<p:tooltip id="tp_titulo_index" for="titulo_index"
									value="#{documento.nombreFichero}" position="top" />
							</p:column>

							<p:column headerText="Nombre fichero" width="80">
								<h:outputText id="nombre_index"
									value="#{documento.nombreFichero}" />
								<p:tooltip id="tp_nombre_index" for="nombre_index"
									value="#{documento.nombreFichero}" position="top" />
							</p:column>

							<p:column headerText="Imágen" width="60">
								<center>
									<p:graphicImage value="#{documento.imagenMuestra}"
										stream="false" height="60" width="60"
										rendered="#{fn:contains(documento.nombreFichero, '.jpg') || fn:contains(documento.nombreFichero, '.png') || fn:contains(documento.nombreFichero, '.gif')}" />
								</center>
							</p:column>

							<p:column width="25">
								<p:commandButton value="Elegir" class="botonExpedienteTab"
									update="formDocumento"
									action="#{linksBean.asignarNuevaImagen(documento,true)}" />
							</p:column>

							<f:facet name="footer">
       				 			Resultado de la búsqueda: #{linksBean.modelDocumento.rowCount} registros.
							</f:facet>
						</p:dataTable>
					</p:panelGrid>
					</h:form>
				</p:dialog>
	</ui:define>
</ui:composition>
