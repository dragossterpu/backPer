<ui:composition template="../layouts/layoutInterior.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="content">
		<div class="content_newForm">
				<div class="titleFormulario">
					<h3 style="margin-top: 0">Înregistrare nou membru</h3>
				</div>
		<div class="container-fluid">
			
			  <div class="aclaraciones">Câmpurile marcate cu (*) sunt obligatorii</div>
			<h:form id="form" class="tabsInvert">
				<p:growl id="msgs" showDetail="true" />
				<p:accordionPanel multiple="true" activeIndex="0,1,2,3">
					<p:tab title="Informații personale / comunicare">
						
						 <p:button
		                        outcome="/users/operacion_masiva_fichero.xhtml"
		                        value="Înregistrare masivă  prin fișier (Excel)" >                    
		                         <f:param name="plantilla"
		                                value="#{Constantes.PLANTILLAALTA}" />
		                    </p:button>
						<div class="tabAccordion">
									
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="nombre" value="* Nume:(Numele de familie)" /></b>
									<p:inputText id="nombre"
										value="#{userBean.usuario.name}" required="true"
										requiredMessage="Introduce numele" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="prenume" value="* Prenume:" /></b>
									<p:inputText id="prenume" required="true"
										value="#{userBean.usuario.lastName}"
										requiredMessage="Introduce numele de familie" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="nif" value="* CNP:" /></b>
									<p:inputText id="nif" value="#{userBean.usuario.idCard}" required="true" 
									requiredMessage="Introduce CNP-ul noului membru" />
								</div>	
							</div>
							<div class="ui-g">								
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="username" value="* Utilizator/ Email:" /></b>
									<p:inputText id="username" ajax="true"
										value="#{userBean.usuario.username}"
										required="true"
										requiredMessage="Introduceți un email valid."
										validatorMessage="Formatul e-mailului nevalid.">
										<f:validateRegex
											pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
									</p:inputText>
									<p:message for="username" display="tooltip" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="rolSelect" value="* Rol:" /></b>
									<p:importEnum
										type="ro.per.online.persistence.entities.enums.RoleEnum"
										var="rol" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.usuario.role}"
										id="rolSelect"
										required="true" requiredMessage="Alegeți un rol pentru noul membru" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alege un rol" itemValue="" />
										<f:selectItems value="#{rol.ALL_ENUM_VALUES}" var="rol"
											itemLabel="#{rol.description}" itemValue="#{rol}" />
									</p:selectOneMenu>							
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="mobilePhone" value="Telefon:" /></b>
									<p:inputText id="mobilePhone"
										value="#{userBean.usuario.phone}" />
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="numberCard" value="Numărul și seria documentului de identitate:" /></b>
									<p:inputText id="numberCard" value="#{userBean.usuario.numberCard}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="address" value="Adresa:" /></b>
									<p:inputText id="address" value="#{userBean.usuario.address}" />
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="birthDate" value="* Data nașterii:(Varstă minimă 18 ani)" /></b>
									<p:calendar id="birthDate" pattern="dd/MM/yyyy" locale="ro" navigator="true"
									required="true" requiredMessage="Alegeți data nașterii" 
									maxdate="#{userBean.currentDate}" value="#{userBean.usuario.birthDate}" />
								</div>
							</div>
							<div class="ui-g">												
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="educationSelect" value="* Nivel de educație:" /></b>
									<p:importEnum
										type="ro.per.online.persistence.entities.enums.EducationEnum"
										var="education" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.usuario.education}"
										id="educationSelect"
										required="true" requiredMessage="Selectați un nivel de educație" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alege un nivel de educație" itemValue="" />
										<f:selectItems value="#{education.ALL_ENUM_VALUES}" var="education"
											itemLabel="#{education.description}" itemValue="#{education}" />
									</p:selectOneMenu>									
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="workplace" value="Locul de muncă:" /></b>
									<p:inputText id="workplace" value="#{userBean.usuario.workplace}" />
								</div>	
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="sexSelect" value="* Sexul:" /></b>
									<p:importEnum
										type="ro.per.online.persistence.entities.enums.SexEnum"
										var="sex" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.usuario.sex}"
										id="sexSelect"
										required="true" requiredMessage="Selectați tipul sexului" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alegeți tipul sexului" itemValue="" />
										<f:selectItems value="#{sex.ALL_ENUM_VALUES}" var="sex"
											itemLabel="#{sex.description}" itemValue="#{sex}" />
									</p:selectOneMenu>								
								</div>
							</div>
							<div class="ui-g">								
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="civilStatusSelect" value="* Starea civilă:" /></b>
									<p:importEnum
										type="ro.per.online.persistence.entities.enums.CivilStatusEnum"
										var="civilStatus" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu value="#{userBean.usuario.civilStatus}"
										id="civilStatusSelect"
										required="true" requiredMessage="Selectați starea civilă" styleClass="form-control form-select">
										<f:selectItem itemLabel="Alegeți starea civila" itemValue="" />
										<f:selectItems value="#{civilStatus.ALL_ENUM_VALUES}" var="civilStatus"
											itemLabel="#{civilStatus.description}" itemValue="#{civilStatus}" />
									</p:selectOneMenu>							
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="provinciaSelect" value="* Județul/Organizația:" /></b>
									 <p:selectOneMenu  value="#{userBean.idProvincia}"  id="provinciaSelect"
				                       class="selectFiltro" required="true" requiredMessage="Selectați județul/ organizația">
				                        <f:selectItem itemLabel="Alege una..." itemValue="" />
				                        <f:selectItems  value="#{userBean.provinces}"  var="provincia" itemLabel="#{provincia.name}"  itemValue="#{provincia.id}" />
				                          <p:ajax event="change" update="locality"
												listener="#{userBean.actualizarLocalidades(userBean.idProvincia)}" />                        
				                    </p:selectOneMenu>	
								</div>							
							</div>						
							<div class="ui-g">							
								
							</div>
							<p:separator />
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6 ui-lg-4">
								<b><h:outputLabel for="locality" styleClass="buscador" value="Localitatea:" /></b>
									<p:separator />									
									<p:selectOneMenu id="locality" value="#{userBean.idLocalidad}"  class="selectFiltro"
									required="true" requiredMessage="Selectați localitatea sau înregistrați localitate nouă" >
										<f:selectItem itemLabel="Alege una..." />
										 <f:selectItems  value="#{userBean.localidades}" var="locality"  itemLabel="#{locality.name}" itemValue="#{locality.id}" />	
									</p:selectOneMenu>								
								</div>
								<div class="ui-g-12 ui-md-6 ui-lg-4">
								<b><h:outputLabel for="buttLocalidad"  value="Înregistrați o nouă localitate:" /></b>
								<p:separator />
								<p:commandButton id="buttLocalidad" title="Adăugare localitate" 
									type="button" onclick="PF('dialogMunicipio').show()" icon="fa fa-fw fa fa-plus" update="crearMunicipio" />									
								</div>
							</div>					
							<p:separator />
							<div class="ui-g">									
								<div class="ui-g-12 ui-md-6 ui-lg-4">								
									<b><h:outputLabel for="imagenG" value="Fotografia :" /></b>
									<p:separator />
									<p:graphicImage rendered="#{not empty userBean.usuario.photo}" id="imagenG" value="#{userBean.usuario.imageUser}" cache="false" stream="false">
									<f:param name="id" value="#{userBean.usuario.id}" />
									 </p:graphicImage>
									</div>	
									<div class="ui-g-12 ui-md-6 ui-lg-4">
									<b><h:outputLabel for="imagenNueva" value="Încarcă noua fotografie:" /></b>
									<p:separator />
									<p:fileUpload fileUploadListener="#{userBean.cargaImagen}" mode="advanced" dragDropSupport="false"
									   sizeLimit="204800" invalidSizeMessage=" Dimensiunea maximă permisă este de 20MB" required="true" 
									   fileLimit="1" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
									   uploadLabel=" Salvează noua fotografie" cancelLabel=" Renunțare" label="Încarcă/Caută fotografia" update="imagenG" /> 
								</div>									
							</div>
							<div class="botonesFormulario">
								<p:commandButton actionListener="#{userBean.restaurarClave}"
									value="Creatiați parola" />
								<p:commandButton
									actionListener="#{userBean.altaUsuario(userBean.usuario)}"
									value="Salvare" update ="@form"/>
							</div>
						</div>
					</p:tab>
					</p:accordionPanel>
				<p:dialog id="dialog" widgetVar="dialogMessage" header="INFO"
					closable="true">
					<p:messages for="dialogMessage" autoUpdate="true" showDetail="true"
						showSummary="true" />
						 <div class="centrarBotonesDialog">
                   <p:button value="Cerrar" outcome="/users/users" />
               </div>
				</p:dialog>
			
		<p:dialog id="crearMunicipio" widgetVar="dialogMunicipio" header="Înregistrare oraș/localitate nouă" position="center" resizable="false" onShow="$('[id*=inputNombre]').val('');" modal="true" width="40%" >
			<h:outputLabel for="inputNombre" value=" Numele noii localități (*):" />
			<p:inputText id="inputNombre" binding="#{nombreMunicipio}"
				required="#{param['form:guardar']!=null}" requiredMessage="Numele orașului nu poate fi gol" converter="#{trimConverter}" />
			
			<h:outputLabel for="typeLocality" value="Alegeți tipul localității (*):" />
			<p:importEnum type="ro.per.online.persistence.entities.enums.TypeLocalityEnum"
				var="typeLocalitys" allSuffix="ALL_ENUM_VALUES" />
				<p:selectOneMenu value="#{userBean.tipLocalidadSelected}" id="typeLocality" class="selectFiltro" style="min-width:initial;" 
				effect="fold" required="#{param['form:guardar']!=null}"  requiredMessage="Este obligatoriu să alegeți un tip de localitate">
					<f:selectItem itemLabel="Alege unul..." itemValue="" />
					<f:selectItems value="#{typeLocalitys.ALL_ENUM_VALUES}"
					var="tipLocalidadSelected"
					itemLabel="#{tipLocalidadSelected.description}"
					itemValue="#{tipLocalidadSelected}" />
				</p:selectOneMenu>
				
			
			<div class="centrarBotonesDialog">
				<p:commandButton id="guardar" value="Inregistrare" actionListener="#{userBean.nuevoMunicipio(nombreMunicipio.value, userBean.provinciaSelect,userBean.tipLocalidadSelected, userBean.usuario)}" 
				update ="@form"  oncomplete="PF('dialogMunicipio').hide()"/>
				<p:commandButton value="Cerrar" onclick="PF('dialogMunicipio').hide()"/>
			</div>
		</p:dialog>				
		</h:form>

		</div>
		<div class="botonesFormulario">
					<p:button outcome="/users/users" value="Volver"
						icon="fa fa-fw fa-undo" />
				</div>
		</div>
	</ui:define>
</ui:composition>
